# -*- coding: utf-8 -*-
<%inherit file="/base.html" />

<%def name="head_tags()">
  <title> Advanced Search</title>

% if c.search and c.q:
  <link rel="alternate" type="application/atom+xml" href="${c.add_facet}&format=atom&rows=c.rows&sort=score+desc" title="Search results for \"${c.q}\""/>
% endif

</%def>
<%def name="header()">
</%def>
<%def name="footer()">
</%def>

	<div id="results">
	<%include file="/search_response_display.html"/>
	</div>
</div>

<div id="facet_wrapper">
<% count = 0 %>
<div id="facet_container">
<div class="facet_chosen">
<div id="current_search"><span>Current Search</span></div>

% if c.q:
<div class="current_facet">
<table>
<tr>
<td class="pagination_label">
%   if c.q != "*:*":
<form action="/search/detailed" method="GET">
<input type="hidden" name="q" value="*:*">
<input type="hidden" name="rows" value="${c.rows}">
<input type="hidden" name="truncate" value="${c.truncate}">
%    if c.chosen_facets:
%      for chosen_facet in c.chosen_facets:
          <%
              current_items = []
              if isinstance(c.chosen_facets[chosen_facet], list):
                  current_items = c.chosen_facets[chosen_facet]
              else:
                  current_items = [c.chosen_facets[chosen_facet]]
          %>
%         for chosen_item in current_items:
              <%
              from urllib import quote
              try:
                  res = '"%s"'%quote(chosen_item.strip())
              except:
                  res = '"%s"'%chosen_item.strip()
              %>
<input type="hidden" name="filter${chosen_facet}" value="${res}"/>
%         endfor
%     endfor 
%    endif
<input type="submit" value="x">
</form>
%   endif
</td>
<td>Text : ${c.q |n}</td>
</tr> 
</table>
<div class="clear"></div>
</div>
% endif

% if c.chosen_facets:
% for facet in c.chosen_facets:
<% 
currentfacet = []
if isinstance(c.chosen_facets[facet], list):
    currentfacet = c.chosen_facets[facet]
else:
    currentfacet = [c.chosen_facets[facet]]
%>
%   for item in currentfacet:
<div class="current_facet">
<table>
<tr>
<td class="pagination_label">
<form action="/search/detailed" method="GET">
<input type="hidden" name="q" value="${c.q}">
<input type="hidden" name="rows" value="${c.rows}">
<input type="hidden" name="truncate" value="${c.truncate}">
%     for chosen_facet in c.chosen_facets:
          <%
              current_items = []
              if isinstance(c.chosen_facets[chosen_facet], list):
                  current_items = c.chosen_facets[chosen_facet]
              else:
                  current_items = [c.chosen_facets[chosen_facet]]
          %>
%         for chosen_item in current_items:
%           if not (chosen_item==item):
                <%
                from urllib import quote
                try:
                    res = '"%s"'%quote(chosen_item.strip())
                except:
                    res = '"%s"'%chosen_item.strip()
                %>                
<input type="hidden" name="filter${chosen_facet}" value="${res}"/>
%           endif
%         endfor
%     endfor
<input type="submit" value="x">
</form>
</td>
<td>${c.field_names[facet]|n} : ${ item |n}</td>
</tr>
</table>
<div class="clear"></div>
</div>
% endfor
% endfor
% endif
</div>

% if c.returned_facets:
% for facet in c.returned_facets:
<% count = count + 1 %>
% if c.returned_facets[facet] and len(c.returned_facets[facet]) > 1:
<div class="facet_results">
<div id="fs${count}" class="subheading"><a id="fh${count}" href="#" >${c.field_names[facet]}</a></div>
<div id="fl${count}" class="facetlist">
<ul>
%     for result,value in c.returned_facets[facet]:
<li><span class="label">
<%
from urllib import quote
try:
   res = quote(result)
except:
   res = result
%>
<a href="${c.add_facet + u'&filter%s="%s"&rows=%d&sort=%s' % (facet, res, c.rows, c.sort)}">${u" ".join(result.split('-'))}</a>
</span> <span class="value">(${value})
%     endfor
</ul>
</div>
</div>
% endif
% endfor
</div>
% endif
</div>
</div>

<![if !IE]>
<script type="text/javascript">
	$(document).ready(function() {
	
	function fhAdjust(){
		//Make sure facets do not stick beneath footer
		$navh = $('#facet_wrapper').height();
		$navh = $navh + 211;
		$wrah = $('#wrapper').height();
		if ($navh > $wrah) {
			$('#wrapper').css("height", $navh + 100);
		} else {
			$mainh = $('#main').height();
			$mainh = $mainh + 91;
			if ($mainh > $navh){
				$('#wrapper').css("height", $mainh + 100);
			} else {
				$('#wrapper').css("height", $navh + 100);
			}
		}
	}
	
	function bindItem(ind){
		$('#fh' + ind).click(function(event) {
			event.preventDefault();
			if ($('#fl' + ind).hasClass("closed")){
			$('#fl' + ind).show();
			$('#fl' + ind).removeClass("closed");
			$('#fh' + ind).css("background-image", "url('/fminus.png')");
			$('#fs' + ind).css("background-color", "#EEE");
			} else {
			$('#fl' + ind).hide();
			$('#fl' + ind).addClass("closed");
			$('#fh' + ind).css("background-image", "url('/fplus.png')");
			$('#fs' + ind).css("background-color", "#BBB");
			}
			fhAdjust();
		});
	}

	for (i=1;i<=${count};i++){
	//Facet Toggle
	$('#fl'+i).hide();
	$('#fl'+i).addClass("closed");
	bindItem(i);
	}

});
</script>
<![endif]>

<!--[if lte IE 8]>
<script type="text/javascript">
	$(document).ready(function() {
		
	function fhAdjust(){
		//Make sure facets do not stick beneath footer
		$navh = $('#facet_wrapper').height();
		$navh = $navh + 211;
		$wrah = $('#wrapper').height();
		if ($navh > $wrah) {
			$('#wrapper').css("height", $navh + 100);
		} else {
			$mainh = $('#main').height();
			$mainh = $mainh + 91;
			if ($mainh > $navh){
				$('#wrapper').css("height", $mainh + 100);
			} else {
				$('#wrapper').css("height", $navh + 100);
			}
		}
	}

	function bindItem(ind){
		$('#fh' + ind).click(function(event) {
			event.preventDefault();
			if ($('#fl' + ind).hasClass("closed")){
			$('#fl' + ind).show();
			$('#fl' + ind).removeClass("closed");
			$('#fh' + ind).css("background-image", "url('/fminus.png')");
			$('#fs' + ind).css("background-color", "#EEE");
			} else {
			$('#fl' + ind).hide();
			$('#fl' + ind).addClass("closed");
			$('#fh' + ind).css("background-image", "url('/fplus.png')");
			$('#fs' + ind).css("background-color", "#BBB");
			}
			fhAdjust();
		});
	}

	for (i=1;i<=${count};i++){
	//Facet Toggle
	$('#fl'+i).addClass("closed");
	bindItem(i);
	}

});
</script>
<![endif]-->

% if not c.docs:
<script type="text/javascript">
	$(document).ready(function() {
		$.backstretch("/../background-book.jpg");
	});
</script>
% endif
